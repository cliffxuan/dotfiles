# set the TMUX_VERSION environment variable
run-shell 'tmux setenv -g TMUX_VERSION $(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'

set-option -g history-limit 5000
unbind C-b
set -g prefix C-Space
# #maximizing and restoring panes.
# unbind +
# bind + new-window -d -n tmp \; swap-pane -s tmp.0 \; select-window -t tmp
# unbind -
# bind - last-window \; swap-pane -s tmp.0 \; kill-window -t tmp

#last-window
bind C-Space last-window

#highlight current window
if-shell -b '[ "$(echo "$TMUX_VERSION < 2.9" | bc)" = 1 ]' " \
    set-window-option -g window-status-current-bg red"
if-shell -b '[ "$(echo "$TMUX_VERSION >= 2.9" | bc)" = 1 ]' " \
    set-window-option -g window-status-current-style bg=red"

# # do not allow renaming of window
# set-option -g allow-rename off

#256 color
set -g default-terminal "screen-256color"

# # Set status bar
set -g status-bg black
set -g status-fg white
set -g status-right '#{cpu_bg_color} CPU: #{cpu_icon} #{cpu_percentage} | %a %h-%d %H:%M '

# Sane scrolling
set -g terminal-overrides 'xterm*:smcup@:rmcup@'

set -g mouse on
# Use vim keybindings in copy mode
setw -g mode-keys vi

# Start copy mode when scrolling up
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e'"

# # ssh key forwarding
set-option -g update-environment "SSH_ASKPASS SSH_AUTH_SOCK SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY"

# # default shell zsh
# # drawback of this is that if zsh is not the default shell, the first window
# # will not be zsh because if-shell is async
# if-shell 'test -x /bin/zsh' 'set-option -g default-shell /bin/zsh'
# # Smart pane switching with awareness of vim splits
# bind -n C-h run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)vim$' && tmux send-keys C-h) || tmux select-pane -L"
# bind -n C-j run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)vim$' && tmux send-keys C-j) || tmux select-pane -D"
# bind -n C-k run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)vim$' && tmux send-keys C-k) || tmux select-pane -U"
# # leave ctrl-L alone
# bind -n C-\ run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)vim$' && tmux send-keys 'C-\\') || tmux select-pane -l"
# # swap with top window
# bind-key T swap-window -t 0

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'Morantron/tmux-fingers'
set -g @plugin 'tmux-plugins/tmux-copycat'

# # esc delay
set -sg escape-time 0

if-shell  "uname | grep -q Darwin" "set-option -g default-command 'reattach-to-user-namespace -l zsh'"

# # Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
